{
    "contents" : "# INFORMACIÓN:\n#\n# El programa calcula medidas de variabilidad estructural y dinámica de alineamientos múltiples de \n# familias de proteínas provenientes de la base de datos de alineamientos múltiples \"Homstrad\".\n#\n# Para utilizar el programa se debe completar un input (\"DATA/Experimental/inputE.csv\") especificando: \n# -family:la familia de proteínas del alineamiento, que puede ser \"SerinProteases\", \"Globins\" o \"Plastocyanins\"\n# -p.ref: la proteína de referncia que se desee utilizar, teniendo en cuenta que la misma debe ser escrita de \n# la msima forma en la que se encuentra en el dataset.\n# -heme: solo se utiliza para la familia de las globinas, puede ser \"TRUE\" o \"FALSE\", dependiendo de si \n# se desea o no considerar al grupo HEMO. \n# -model: el modelo de red elástica a usar, que solo puede ser \"ANM\" por el momento.\n# -R0: cut-off del ANM.\n\n#Remove objects#\nrm(list = ls())\n\n#Read input#\ndata.dir <- \"DATA/Experimental\"\n\ninput.dir <- file.path(data.dir,\"InputE.csv\")\ninput <- read.csv(input.dir)\n\n#Reference family and protein#\nfamily <- input$family\np.ref <- input$p.ref \nheme = input$heme\n\n#ENM#\nmodel <- input$model\nR0 = input$R0\n\n#Files dir#\nalign.dir <- file.path(data.dir,paste(family,\"Alignments.txt\",sep=\"\")) #File with a multiple sequence alignment from Homstrad#\npdbs.dir <- file.path(data.dir,paste(family,\"Coordinates.pdb\",sep=\"\")) #Coordinates of the proteins# \ndataset.dir <- file.path(data.dir,paste(family,\"Dataset.csv\",sep=\"\")) #Dataset with pdbids and chains# \n\n#Functions dir#\nf.readCA <-\"FUNCTIONS/ReadCA.R\" \nf.readHeme <- \"FUNCTIONS/ReadHeme.R\"  \nf.alignment <- \"FUNCTIONS/Alignment.R\" \nf.ID <- \"FUNCTIONS/ID.R\" \nf.Keff <- \"FUNCTIONS/Keff.R\"  \nf.K <- \"FUNCTIONS/K.R\"  \nf.kij.function <- file.path(\"FUNCTIONS\",paste(\"Kij.\",model,\".R\",sep = \"\")) \nf.variability <- \"FUNCTIONS/Variability.R\" \n\n#Output dir#\nOUT <- \"OUT/Experimental\"\n\n#General parameters#\nTOLERANCE = 1e-10 \n\n#Load Librarys#\nlibrary(seqinr) \nlibrary(bio3d) \n\n#Load Functions#\nsource(f.readCA) \nsource(f.readHeme) \nsource(f.alignment)\nsource(f.ID)\nsource(f.Keff)\nsource(f.K)\nsource(f.kij.function)\nsource(f.variability)\n\n#Read Dataset#\nDataset <- read.csv(dataset.dir)\npdbids <- Dataset$pdbid\nchains <- Dataset$chain\nnprot = length(pdbids)\n\n#Read multiple alignment#\nalignments.id <- read.fasta(align.dir)\nalignments <- alignments.id$ali[,-ncol(alignments.id$ali)]\n\n#Read PDB & alignment of P.ref#\nchain.Pref <- chains[pdbids == as.character(p.ref)]\npdb.Pref <- readCA(pdbs.dir,chain.Pref)\nr.Pref = pdb.Pref$xyz.calpha\nnsites.Pref = pdb.Pref$nsites \nnaa.Pref = nsites.Pref #naa = n.aminoaids, nsites = n.aminoácids + n.atoms we want to consider, ej.: Ns and Fe from heme group in Globins# \n\nif ((family == \"Globins\") & (heme == \"TRUE\")){\n  r.heme.Pref = readHeme(pdbs.dir,chain.Pref)\n  r.Pref = cbind(r.Pref,r.heme.Pref)\n  nsites.Pref = ncol(r.Pref)\n}\n\nalignment.Pref <- alignments[alignments.id$id == as.character(p.ref),]\n\n#Variability#\ndf.lalign = matrix(ncol = 1 , nrow = nprot)\ndf.ID = matrix(ncol = 1 , nrow = nprot)\ndf.nH = matrix(ncol = 3*naa.Pref , nrow = nprot)\ndf.Pn = matrix(ncol = 3*naa.Pref , nrow = nprot)\ndf.evalues = matrix(ncol = 3*naa.Pref , nrow = nprot)\ndf.d.evalues = matrix(ncol = 3*naa.Pref , nrow = nprot)\ndf.dr.squarei = matrix(ncol = naa.Pref , nrow = nprot)\n\nfor (P in (1:nprot)){\n  \n\t#Read PDB & alignment of P2#\n\tchain.P2 <- chains[[P]]\n\tpdb.P2 <- readCA(pdbs.dir,chain.P2)\n\tr.P2 <- pdb.P2$xyz.calpha\n\tnsites.P2 <- pdb.P2$nsites\n\tnaa.P2 = nsites.P2\n\t\n\tif ((family == \"Globins\") & (heme == \"TRUE\")){\n\t  r.heme.P2 = readHeme(pdbs.dir,chain.P2)\n\t  r.P2 = cbind(r.P2,r.heme.P2)\n\t  nsites.P2 = ncol(r.P2)\n\t}\n\n\talignment.P2 <- alignments[alignments.id$id == as.character(pdbids[P]),]\t\n\t\n\t#Analyze alignment of Pref#\n\ta.align.Pref <- alignment(alignment.Pref,alignment.P2,naa.Pref)\n\talign.Pref.index <- a.align.Pref$align.index\n\tnalign <- a.align.Pref$nalign\n\tr.align.Pref <- r.Pref[,align.Pref.index]\n\tno.align.Pref.index <- a.align.Pref$no.align.index\n\t\n\tif ((family == \"Globins\") & (heme == \"TRUE\")){\n\t  no.align.Pref.index <- cbind(no.align.Pref.index,t(seq((naa.Pref+1),nsites.Pref)))\n\t}\n\t\n\t#Cakculate KEFF Pref#\n\tKeff.Pref <- keff(r.Pref,align.Pref.index,no.align.Pref.index,kij.function,R0,TOLERANCE)\t\n\tnmodes <- length(Keff.Pref$va)\n\t\n\t#Calculate %ID between P.ref y P2#\n\tID.P <- ID(alignment.Pref,alignment.P2)\n\t\n\t#Analyze alignment of P2#\n\ta.align.P2 <- alignment(alignment.P2,alignment.Pref,naa.P2)\n\talign.P2.index <- a.align.P2$align.index\n\tno.align.P2.index <- a.align.P2$no.align.index\n\t\n\tif ((family == \"Globins\") & (heme == \"TRUE\")){\n\t  no.align.P2.index <- cbind(no.align.P2.index,t(seq((naa.P2+1),nsites.P2)))\n\t}\n\t\n\t#Rotate P2 minimizing RMSD with P.ref#\n\talign.Pref.index3N = matrix(0 , ncol = 3*nalign, nrow = 1)\n\talign.P2.index3N = matrix(0 , ncol = 3*nalign, nrow = 1)\n  for (i in (1: nalign)){\n    align.Pref.index3N[1,((3*i-2):(3*i))] = c((3*align.Pref.index[i]-2),(3*align.Pref.index[i]-1),(3*align.Pref.index[i]))\n    align.P2.index3N[1,((3*i-2):(3*i))] = c((3*align.P2.index[i]-2),(3*align.P2.index[i]-1),(3*align.P2.index[i]))\n  }\n\n\tr.P2 <- matrix(fit.xyz(fixed = as.vector(r.Pref),\n\tmobile = as.vector(r.P2),\n\tfixed.inds = align.Pref.index3N,\n  mobile.inds = align.P2.index3N\n\t),nrow=3)\n\t\n\tr.align.P2 <- r.P2[,align.P2.index]\n\t\n\t#Cakculate KEFF P2#\t\n\tKeff.P2 <- keff(r.P2,align.P2.index,no.align.P2.index,kij.function,R0,TOLERANCE)\t\n\t\n\t#dr#\t\n\tdr = r.align.P2 - r.align.Pref\n\n\t#Variability#\n\tVA <- variability(dr,Keff.Pref,Keff.P2)\n\tdf.ID[P] = ID.P\n  df.lalign[P] = nalign \n  df.nH[P,1:nmodes] = t(VA$nH)\n  df.Pn[P,1:nmodes] = t(VA$Pn)\n  df.d.evalues[P,1:nmodes]  = t(VA$d.evalues[1:nmodes])\n\tdf.evalues[P,1:nmodes]  = t(Keff.Pref$va[1:nmodes])\n\tdr.squarei = rbind(VA$dr.squarei,align.Pref.index)\n\tfor (i in (1:naa.Pref)){\n\t\tdf.dr.squarei[P,i]= matrix(dr.squarei[1,dr.squarei[2,]==i],ncol=1,nrow=1)\n\t}\n}\n\nP.index = (pdbids != as.character(p.ref))\n\ndf.ID <- df.ID[P.index,]\ndf.lalign <- df.lalign[P.index,]\ndf.nH <- df.nH[P.index,]\ndf.Pn <- df.Pn[P.index,]\ndf.d.evalues <- df.d.evalues[P.index,]\ndf.evalues <- df.evalues[P.index,]\ndf.dr.squarei <- df.dr.squarei[P.index,]\n\n#Calculate means#\nmean.nH = colMeans(df.nH,na.rm=T)\nmean.Pn = colMeans(df.Pn,na.rm=T)\nmean.d.evalues= colMeans(df.d.evalues,na.rm=T)\nmean.evalues= colMeans(df.evalues,na.rm=T)\nMSDi = colMeans(df.dr.squarei,na.rm = T)\nMSD = rowMeans(df.dr.squarei,na.rm = T)\n\n#SAVE INFORMATION#\nif (family == \"Globins\") family <- paste(family,\"Heme\",heme,sep =\"\")\n\n#Dataframes#\nwrite.csv(df.lalign,file = file.path(OUT , paste(family , \".Out.df.lalign.csv\" , sep = \"\")) , row.names = FALSE)\nwrite.csv(df.ID,file = file.path(OUT, paste(family , \".Out.df.ID.csv\" , sep = \"\")) , row.names = FALSE)\nwrite.csv(df.nH,file = file.path(OUT , paste(family , \".Out.df.nH.csv\" , sep = \"\")) , row.names = FALSE)\nwrite.csv(df.Pn,file = file.path(OUT , paste(family , \".Out.df.Pn.csv\" , sep=\"\")) , row.names = FALSE)\nwrite.csv(df.d.evalues,file = file.path(OUT , paste(family , \".Out.df.d.evalues.csv\" , sep = \"\")) , row.names = FALSE)\nwrite.csv(df.evalues,file = file.path(OUT , paste(family , \".Out.df.evalues.csv\" , sep = \"\")), row.names = FALSE)\nwrite.csv(df.dr.squarei,file = file.path(OUT , paste(family , \".Out.df.dr.squarei.csv\" , sep = \"\")) , row.names = FALSE)\n\n#Means#\nwrite.csv(mean.nH,file = file.path(OUT , paste(family , \".Out.nH.mean.csv\" , sep = \"\")) , row.names = FALSE)\nwrite.csv(mean.Pn,file = file.path(OUT , paste(family , \".Out.Pn.mean.csv\" , sep = \"\")) , row.names = FALSE)\nwrite.csv(mean.d.evalues,file = file.path(OUT , paste(family , \".Out.d.evalues.mean.csv\" , sep = \"\")) , row.names = FALSE)\nwrite.csv(mean.evalues,file = file.path(OUT , paste(family , \".Out.evalues.mean.csv\" , sep = \"\")) , row.names = FALSE)\nwrite.csv(MSDi,file = file.path(OUT , paste(family , \".Out.MSDi.csv\" , sep = \"\")) , row.names = FALSE)\nwrite.csv(MSD,file = file.path(OUT , paste(family , \".Out.MSD.csv\", sep = \"\")) , row.names = FALSE)\n\n#input#\nwrite.csv(input,file = file.path(OUT , paste(family , \".Input\" , sep = \"\")) , row.names = FALSE)\n",
    "created" : 1443377497689.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2916465632",
    "id" : "49CBF5A8",
    "lastKnownWriteTime" : 1443625116,
    "path" : "C:/Users/Laurita/Desktop/Doctorado/Variabilidad Estructural/ExperimentalMain.R",
    "project_path" : "ExperimentalMain.R",
    "properties" : {
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "type" : "r_source"
}